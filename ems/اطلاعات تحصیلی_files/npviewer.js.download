!function(n){n.widget("np.npviewer",{options:{furl:{src:null,url:null,a:null,f:null,ftck:null,docid:null,doctck:null,doctx:null,pgno:1,sanjesh:null,s:null,c:null,t:null,l:null,ct:null,cm:null,u:null,uen:null,reqtype:null,seqno:null,empno:null,fuq:null,nozoomfit:null},url:null,autoOpen:!0,type:"img",hasconf:!1,conftext:"",conficon:"circle-plus",onconf:null,html:"<div />",inwin:!0,winclass:"",NoBar:!1,NoDocBar:!1,NoDrag:!1,OnMouseOver:null,OnMouseOut:null,Binary:null,zoomable:!1,StopFitSize:!1,SetImageInCenter:!1,ImageStyle:null,ForceWidth:!1,BarPosition:"bottom right",BarStyle:null,DocTitle:"",DocTitleStyle:null,ExtraButtons:[],dwLink:!0,onClose:null},_$nex:null,_$prv:null,_justopen:!0,_pagecnt:-1,_rotatedeg:0,_create:function(){var t=this,o=t.options,i=t.element;t.$c=n('<div class="d-flex flex-column w-100 position-relative"></div>').appendTo(i),o.nozoomfit||t.$c.addClass("h-100"),o.Binary||(t.MakeUrl(),t.SetType(),t.NoBarInDialog=!1,o.autoOpen&&t.init())},ShowBinaryImage:function(){var n=this,t=n.options;n.element;n.$c.empty().append("<img  src='data:image/jpeg;base64,"+t.Binary+"' style='width:100%;height:100%' />")},getBinary:function(){var n=this.options.binary;this.$Ifr.contents().find("img").attr("src","data:image/jpeg;base64,"+hexToBase64(n))},hexToBase64:function(n){return btoa(String.fromCharCode.apply(null,n.replace(/\r|\n/g,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")))},SetType:function(){var n=this.options;switch(n.type){case"image/gif":case"image/pjpeg":case"image/jpeg":case"image/x-png":case".gif":case".jpg":case"img":case"":n.type="img";break;case"application/pdf":case".pdf":case"pdf":n.type="pdf";break;case"text/html":n.type="txt";break;default:n.type="othr"}},MakeUrl:function(){var t=this.options,o="";n.each(t.furl,(function(n,t){"url"!==n&&t&&(o=o+"&"+n+"="+t)})),o&&(o=o.substr(1)),t.furl.url?t.url=t.furl.url+"?"+o:(t.url=np.apiUrl+"/frmc/showpic/showpic?"+o,t.url+="&ttt"+parseInt(1e6*Math.random())+"="+Math.random(),t.furl.docid&&(t.url+="&r="+Math.random()))},init:function(){var t=this,o=t.element,i=t.options;i.url;if(i.npform){if(i.npform.IsWebBusy())return void setTimeout((function(){t.init()}),500);i.furl.a=i.npform.GetAut(),t.MakeUrl()}t.bodyscrolltop=document.body.scrollTop,t._pagecnt=-1,t.LoadBlank=!1,t.nex_button_disabled=!1,t.prv_button_disabled=!1,i.type="",0==t.$c.parent().length&&(i.inwin||t.$c.empty(),t.$c.appendTo(o)),i.inwin?(t.$c.SimpleDialog({appendTo:i.appendTo,title:""==i.DocTitle?"مشاهده فایل":i.DocTitle,class:i.winclass||"col-12 col-md-9",close:function(n){t.$c.empty(),t._trigger("onClose",n)},destroyOnClose:!0}),t.$Ifr&&i.url&&t.$Ifr.attr("src",i.url),t.$c.SimpleDialog("show")):(t.$c.empty(),o.show()),!i.NoBar&&!i.inwin&&o.closest(".ui-dialog").length>0?t.$bar=o.closest(".ui-dialog").length?n("<div />"):n('<div  style="position:absolute;bottom:45px"/>'):t.$bar=n("<div />"),-1!=i.BarPosition.indexOf("center")&&t.$bar.css("text-align","center"),-1!=i.BarPosition.indexOf("left")&&t.$bar.css("text-align","left"),i.BarStyle&&t.$bar.css(i.BarStyle);var e=t.$dwLink=n('<div class="p-2" style="display:none"><a target="_blank">مشاهده</a></div>'),a=n('<div style="position:sticky;bottom:0;background-color:white;padding:3px;margin-top:2px"></div>'),s=n("<div></div>").appendTo(a);t._imglod=n("<img />").attr("src","/_Images/WebBusy.gif").appendTo(s),t._$prv=n("<button/>").html('<div class="np-d-none d-sm-inline" >صفحه قبل</div>').npButton({disabled:t.prv_button_disabled,tip:"صفحه قبل",icons:{primary:"ui-icon-triangle-1-n"}}).appendTo(t.$bar).hide(),t._$nex=n("<button/>").html('<div class="np-d-none d-sm-inline" >صفحه بعد</div>').npButton({disabled:t.nex_button_disabled,tip:"صفحه بعد",icons:{primary:"ui-icon-triangle-1-s"},iconPosition:"end"}).appendTo(t.$bar).hide();var r=t.$Ifr=n('<IFRAME frameborder="0" dir="rtl" style="visibility:hidden;height:auto" onload="javascript:this.style.height = this.contentWindow.document.body.scrollHeight + \'px\';" />').appendTo(t.$c).addClass("flex-grow-1");e.insertAfter(r),t.$bar.appendTo(a),a.insertAfter(e),t.ImageButton=n('<span id="ImageButton" />').hide().appendTo(t.$bar);for(var l=n("<button/>").html('<div class="np-d-none d-sm-inline" >بزرگ نمايي</div>').npButton({tip:"بزرگ نمايي",icons:{primary:"glyphicon-zoom-in"}}).appendTo(t.ImageButton),p=n("<button/>").html('<div class="np-d-none d-sm-inline" >کوچک نمايي</div>').npButton({tip:"کوچک نمايي",icons:{primary:"glyphicon-zoom-out"}}).appendTo(t.ImageButton),d=n("<button/>").html('<div class="np-d-none d-sm-inline" >1:1</div>').npButton({tip:"1:1",icons:{primary:"glyphicon-marquee"}}).appendTo(t.ImageButton),c=t._zoomfit=n("<button/>").html('<div class="np-d-none d-sm-inline" >نماي کلي</div>').npButton({tip:"نماي کلي",icons:{primary:"glyphicon-gift"}}).appendTo(t.ImageButton),u=n("<button/>").html('<div class="np-d-none d-sm-inline" >چرخش</div>').npButton({tip:"چرخش",icons:{primary:"glyphicon-repeat"}}).appendTo(t.ImageButton),m=0;m<i.ExtraButtons.length;m++)n("<button/>").html('<div class="np-d-none d-sm-inline" >'+i.ExtraButtons[m].text+"</div>").npButton({tip:i.ExtraButtons[m].tip,icons:{primary:i.ExtraButtons[m].icon}}).insertAfter(t.ImageButton).click(i.ExtraButtons[m].ClickCallback);n(t.ImageButton).hide(),l.click((function(){t._zoom("+")})),p.click((function(){t._zoom("-")})),d.click((function(){t._zoom("nozoom")})),c.click((function(){t._zoom("zoomfit")})),u.click((function(){t._rotate(90)})),"1"==i.furl.pgno&&t._$prv.npButton("option","disabled",!0),t._$nex.click((function(){t.PageCount(),t._nextpage(),t._$prv.npButton("option","disabled",!1),i.furl.pgno==t._pagecnt&&t._$nex.npButton("option","disabled",!0)})),t._$prv.click((function(){t.PageCount(),t._prvpage(),t._$nex.npButton("option","disabled",!1),1==i.furl.pgno&&t._$prv.npButton("option","disabled",!0)})),i.hasconf&&n("<button/>").text(i.conftext).npButton({icons:{secondary:"ui-icon-"+i.conficon}}).appendTo(t.$bar).click((function(){t._trigger("onconf"),i.inwin&&t.$c.SimpleDialog("destroy")})),t.IfrLoadDone=!1,r.bind("readystatechange",(function(){"complete"==this.readyState&&(t.IfrLoadDone||(i.NoBar?t._imglod.css("display","none"):t._imglod.css("visibility","hidden"),t._$prv&&(t.prv_button_disabled=t._$prv.npButton("option","disabled")),t._$nex&&(t.nex_button_disabled=t._$nex.npButton("option","disabled")),t.LoadBlank?t.$Ifr.attr("src",i.url):t.IfrLoadDone=!0,t.LoadBlank=!1,t.AfterLoad())),"interactive"!=this.readyState||"othr"!=i.type||t.IfrLoadDone||(t.IfrLoadDone=!0,t.AfterLoad())})),r.on("load",(function(){t.IfrLoadDone||(i.NoBar?t._imglod.css("display","none"):t._imglod.css("visibility","hidden"),t._$prv&&(t.prv_button_disabled=t._$prv.npButton("option","disabled")),t._$nex&&(t.nex_button_disabled=t._$nex.npButton("option","disabled")),t.LoadBlank&&!t.inZoom?t.$Ifr.attr("src",i.url):t.IfrLoadDone=!0,t.LoadBlank=!1,t.AfterLoad())}));var g=i.furl.pgno?i.furl.pgno:1;t._showpage(g),t.tt=500,t.Loaded()},Loaded:function(){var n=this,t=(n.element,n.options);setTimeout((function(){n.$Ifr.css("visibility","visible"),""!=t.type?n.IfrLoadDone||"othr"!=t.type||n.AfterLoad(1):n.Loaded()}),500)},PageCount:function(){for(var n=this,t=(n.element,n.options,document.cookie.split("; ")),o=0,i=t.length;o<i;o++){var e=t[o].split("=");"picdata"==e[0]&&(n._pagecnt=e[1])}},AfterLoad:function(t){var o,i=this,e=i.element,a=i.options,s=i.$Ifr,r=s.contents().find("img");s.removeClass("np-d-none"),s.siblings("img").remove(),n(i.ImageButton).hide(),i.PageCount(),1==i._pagecnt?(i._$nex.npButton("option","disabled",!0),i._$prv.npButton("option","disabled",!0)):(i._$nex.npButton("option","disabled",!1),i._$prv.npButton("option","disabled",!1)),"1"==a.furl.pgno&&i._$prv.npButton("option","disabled",!0),i._pagecnt==a.furl.pgno&&i._$nex&&i._$nex.npButton("option","disabled",!0);try{o=s.contents()[0].contentType}catch(e){o="othr"}switch(n("a",i.$dwLink).attr("href",s.attr("src")),o){case"image/gif":case"image/pjpeg":case"image/x-png":case".gif":case"image/jpeg":case".jpg":case"image/png":case"img":a.type="img";break;case"application/pdf":case".pdf":case"pdf":a.type="pdf";break;case"text/html":a.type="txt";break;default:a.type="othr"}if(-1!=a.BarPosition.indexOf("top")&&(i.$bar.css({bottom:"auto",top:"0px"}),a.ExtraButtons&&i.$Ifr.css("margin-top","75px")),i.inZoom&&(a.type="img"),!a.NoBar||i.LoadBlank||t||(i.FullScr=n("<span class='ui-icon ui-icon-zoomin' style='float:right;position:relative;bottom:"+i.img_h+";visibility:hidden'/>").appendTo(i.$Ifr.parent("div")),r.length>0&&a.ImageStyle&&r.css(a.ImageStyle),i.$Ifr.css("width","100%").css("height","100%"),i.$Ifr.parent().on("mouseenter mouseleave",(function(n){switch(n.type){case"mouseenter":i.FullScr.css("visibility","");break;case"mouseleave":i.FullScr.css("visibility","hidden")}})),i.FullScr.on("click",(function(n){return i.NoBarInDialog=!0,a.inwin=!0,e.css("overflow","hidden"),i.$c.empty(),i.init(),!1}))),i.ShowExtra(i.$bar,s),("img"==a.type||a.hasconf)&&(i.$bar=n("<div/>").appendTo(i.$c)),"img"!=a.type||a.NoDrag||(s.contents().find("img").draggable(),i._imglod.css("display","none")),"img"!=a.type||a.nozoomfit||i._zoom("zoomfit"),document.body.scrollTop=i.bodyscrolltop,i.NoBarInDialog&&(n(i.ImageButton).show(),i.FullScr.hide()),"img"==a.type)s.contents().find("body").css("width","auto").css("height","auto"),!a.inwin&&a.zoomable&&(r.on("mouseover",(function(t){if(!i.inZoom){var o=n("<button/>").nptinybutton({icon:"view",attr:{style:"position:absolute;top:0px;left:0px"}}).nptinybutton("cont");n(o).appendTo(i.$c).on("click",(function(){n("<div></div>").appendTo(i.options.npform.$np("#bod")).npviewer({appendTo:i.options.npform.$np("#bod"),inwin:!0,NoBar:!1,npform:i.options.npform,zoomable:!1,furl:i.options.furl,autoOpen:!0})}))}})),i.$c.on("mouseleave",(function(t){i.inZoom||n("button[np-icon]",i.$c).remove()}))),i.$dwLink.hide();else if("txt"!=a.type&&(a.dwLink&&i.$dwLink.show(),!a.inwin)){var l=s.contents().find("body").html();l.length<500&&""==(l=l.replace(/<\!--.*--\>/g,"").trim())&&i.$Ifr.addClass("np-d-none")}},ShowExtra:function(t,o){var i=this,e=(i.element,i.options);if(i.$Ifr=i.inZoom?i.FrameInZoom:i.$Ifr,"img"===e.type){var a;o.contents().find("body").css({overflow:"hidden",direction:"RTL"}),e.SetImageInCenter&&(o.contents().find("body").css({display:"flex","justify-content":"center"}),o.parent().css("width","auto")),e.NoBar&&!i.NoBarInDialog||(o.contents().find("body").css({"margin-right":"15px","margin-top":"5px"}),n(i.ImageButton).show()),a=i.$Ifr.contents().find("img").length>0?i._img=i.$Ifr.contents().find("img").css("cursor","move"):i._img=i.$Ifr.siblings("img").css("cursor","move");i._imgdiv=o;i._imgrealwidth=a.width(),i._imgrealheight=a.height(),i._imgHor=i._imgrealwidth>i._imgrealheight}e.furl.docid&&!e.NoDocBar&&(n(i._$nex).show(),n(i._$prv).show())},hide:function(){this.element.hide()},empty:function(){var n=this.options,t=this.element;n.inwin&&t.SimpleDialog("destroy")},_setOptions:function(n){var t=this;t._super(n),t.MakeUrl(),t.SetType(),n.autoOpen&&t.init()},zoom:function(n){this._zoom(n)},_zoom:function(n){var t,o=this,i=o._imgdiv;o.$Ifr=o.inZoom?o.FrameInZoom:o.$Ifr;var e,a=(t=o.$Ifr.contents().find("img").length>0&&"none"!=o.$Ifr.css("display")?o.$Ifr.contents().find("img"):o.$Ifr.siblings("img")).width()||1,s=i?i.width()||1:t.width()||1,r=i?i.height()||1:t.height()||1,l=t.height()||1;switch(t.css("left",""),t.css("top",""),t.css("right",""),t.css("bottom",""),n){case"nozoom":e=1;break;case"zoomfit":e=s/a>r/l?r/l:s/a;break;case"+":e=1.1;break;case"-":e=.9}1==e&&"zoomfit"!=n?(a="",l=""):o._imgHor?(a*=e,l=""):(a="",l*=e),t.css("width",a),t.css("height",l),a>s||l>r?t.css({cursor:"move",right:"auto"}):t.css("cursor","default")},_rotate:function(n){var t,o=this;o.$Ifr=o.inZoom?o.FrameInZoom:o.$Ifr,t=o.$Ifr.contents().find("img").length>0&&"none"!=o.$Ifr.css("display")?o.$Ifr.contents().find("img"):o.$Ifr.siblings("img"),(n+=o._rotatedeg)>360&&(n-=360),o._rotatedeg=n,t.hide("fade",(function(){t.css({"-webkit-transform":"rotate("+n+"deg)","-moz-transform":"rotate("+n+"deg)","-ms-transform":"rotate("+n+"deg)","-o-transform":"rotate("+n+"deg)",transform:"rotate("+n+"deg)",zoom:1}),t.show("fade"),t.css({top:0,left:0}),t.css("cursor","move")}))},_showpage:function(n){var t=this,o=(t.element,t.options),i=o.url;t.$dwLink.hide(),i=i.replace("pgno="+o.furl.pgno,"pgno="+n),o.url=i,o.furl.pgno=n,o.NoBar||t._imglod.css("visibility",""),t._imglod.css("display",""),t.IfrLoadDone=!1,t.LoadBlank=!0,o.type="",t.$Ifr.attr("src","../../blank.htm")},_nextpage:function(){this._showpage(parseInt(this.options.furl.pgno,10)+1)},_prvpage:function(){this._showpage(parseInt(this.options.furl.pgno,10)-1)},GetPageNo:function(){this.element;return this.options.furl.pgno},_destroy:function(){var n=this;n.options,n.element;n.$c.empty()}})}(jQuery);
